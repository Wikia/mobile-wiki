<!DOCTYPE html>
<html>
<head>
	{{content-for 'head'}}
	<script>
		// initialize objects needed for Oasis
		Wikia = {};
		Mercury = {};
		M = {};
		// initialize objects needed for AdEngine
		mw = { loader: { state: function() {} } };
		wgNow = new Date();
	</script>
	<script>
		(function () {
			var shoeboxCache = {};

			function getProp(obj, path) {
				// TODO split, join, split, this can be optimized
				var parts = path.split('.');

				if (parts.length > 1) {
					var value = obj,
						length = parts.length;

					for (var i = 0; i < length; i++) {
						if (!value.hasOwnProperty(parts[i])) {
							return;
						}

						value = value[parts[i]];
					}

					return value;
				}

				return obj[path];
			}

			M.getFromShoebox = function (path) {
				var parts = path.split('.');
				var key = parts.shift();

				var el = document.querySelector('#shoebox-' + key);
				if (!el) { return; }

				var valueString = el.textContent;
				if (!valueString) { return; }

				var shoeboxItem = JSON.parse(valueString);
				shoeboxCache[key] = shoeboxItem;

				if (parts.length === 0) {
					return shoeboxItem;
				}

				return getProp(shoeboxItem, parts.join('.'));
			};
		})();
	</script>
	<script>
		(function () {
			// Normally we would use $.cookie but jQuery isn't loaded yet
			function getCookie(name) {
				var value = '; ' + document.cookie,
					parts = value.split('; ' + name + '=');

				if (parts.length === 2) {
					return decodeURIComponent(parts.pop().split(';').shift());
				}
			}

			var geoCookie = getCookie('Geo');

			if (geoCookie) {
				M.geo = JSON.parse(geoCookie);
			} else if (M.getFromShoebox('config.environment') === 'dev') {
				M.geo = {
					country: 'wikia-dev-country',
					continent: 'wikia-dev-continent'
				};
			} else {
				console.debug('Geo cookie is not set');
			}
		})();
	</script>
	<script>
		(function () {
			M.loadScript = function (src, async, onload) {
				var firstScriptInDocument = document.getElementsByTagName('script')[0];
				var scriptTag = document.createElement('script');

				scriptTag.src = src;
				scriptTag.async = async;

				if (typeof onload === 'function') {
					scriptTag.onload = onload;
				}

				firstScriptInDocument.parentNode.insertBefore(scriptTag, firstScriptInDocument);
			};
		})();
	</script>
	<script>
		(function () {
			var prefix = document.location.protocol === 'https:' ? 'https://secure' : 'http://edge';

			if (M.getFromShoebox('runtimeConfig.noExternals')) {
				window.trackQuantcastPageView = function () {};
				return;
			}

			M.loadScript(prefix + '.quantserve.com/quant.js?' + Math.random(), true);

			window.trackQuantcastPageView = function () {
				window._qevents = window._qevents || [];

				if (window.__qc) {
					window.__qc.qpixelsent = [];
				}

				window._qevents.push({
					qacct: M.getFromShoebox('tracking.quantcast'),
					labels: 'Category.MobileWeb.Mercury'
				});

				console.info('Track pageView: Quantserve');
			};

			window.trackQuantcastPageView();
		})();
	</script>
	<script>
		(function () {
			var prefix = (document.location.protocol === 'https:' ? 'https://sb' : 'http://b');

			if (M.getFromShoebox('runtimeConfig.noExternals')) {
				window.trackComscorePageView = function () {};
				return;
			}

			M.loadScript(prefix + '.scorecardresearch.com/beacon.js', false);

			window._comscore = window._comscore || [];

			window.trackComscorePageView = function () {
				var config = M.getFromShoebox('tracking.comscore') || {};

				window._comscore.push({
					c1: '2',
					c2: config.id,
					options: {
						url_append: config.keyword + '=' + config.c7Value
					}
				});

				/*
				 Whenever comscore script loads it'll send all the events from the _comscore array
				 but on the second page view in a session we don't want to load the script once again
				 that is why we have to call purge method here
				 It'll make sure that whatever is in _comscore gets send
				 */
				if (window.COMSCORE) {
					if (window.COMSCORE.purge) {
						window.COMSCORE.purge();
					}
				}

				console.info('Track pageView: Comscore');
			};

			window.trackComscorePageView();
		})();
	</script>
	{{content-for 'head-footer'}}
</head>
<body class="mobile-wiki">
<div id="ember-container">{{content-for 'body'}}</div>
<!--{{> qualaroo}}-->
<!--
{{! @todo (XW-1374) this should be an Ember addon }}
{{! Idea from https://davidwalsh.name/css-animation-callback }}
{{! TODO move firstRenderTime to a separate view }}
-->
<span class="render-time-test"></span>
<style type="text/css">
	.render-time-test {
		transition-property: opacity;
		transition-duration: 1ms;
		opacity: 0;
	}

	.render-time-test.measure {
		opacity: 1;
	}
</style>
<script>
	/**
	 * @returns {String|null}
	 */
	function whichTransitionEnd() {
		var fakeElement = document.createElement('fakeelement'),
				transitions = {
					'transition': 'transitionend',
					'OTransition': 'oTransitionEnd',
					'MozTransition': 'transitionend',
					'WebkitTransition': 'webkitTransitionEnd'
				};

		for (var t in transitions) {
			if (fakeElement.style[t] !== undefined) {
				return transitions[t];
			}
		}

		return null;
	}

	var testElement = document.getElementsByClassName('render-time-test')[0],
			transitionEnd = whichTransitionEnd();

	if (transitionEnd && window.performance && typeof window.performance.now === 'function') {
		testElement.addEventListener(transitionEnd, function () {
			window.firstRenderTime = window.performance.now();
		});

		// Transition isn't triggered without setTimeout because of browser optimizations
		setTimeout(function () {
			testElement.classList.add('measure');
		}, 0);
	}
</script>

<script src="/mobile-wiki/assets/vendor.js" defer crossorigin="anonymous"></script>
<script src="/mobile-wiki/assets/mobile-wiki.js" defer crossorigin="anonymous"></script>

<script>
	(function () {
		function htmlToElement(html) {
			var template = document.createElement('template');

			template.insertAdjacentHTML('beforeend', html);

			return template.firstChild;
		}

		function loadDOMResource(src) {
			var ajax = new XMLHttpRequest();

			ajax.onload = function () {
				var element = htmlToElement(ajax.responseText);

				element.style.cssText = 'height: 0; width: 0; position: absolute; overflow: hidden;';

				document.body.insertBefore(element, document.body.firstChild);
			};

			ajax.onerror = function (error) {
				throw new URIError('The resource ' + error.target.src + ' is not accessible.');
			};

			ajax.open('GET', src, true);
			ajax.send();
		}

		loadDOMResource('/mobile-wiki/assets/main.svg');
		loadDOMResource('/mobile-wiki/assets/common.svg');
		loadDOMResource('/mobile-wiki/assets/design-system.svg');
	})();
</script>

<script src="/__load/-/only=scripts/wikia.ext.instantGlobals,instantGlobalsOverride,abtesting,abtest"></script>

<script>
	(function() {
		var allowExternals = !M.getFromShoebox('runtimeConfig.noExternals'),
			triedToTrackWithoutLoadedLibrary = false,
			ivw3 = M.getFromShoebox('tracking.ivw3') || {};

		if (
			allowExternals &&
			window.Wikia && Wikia.InstantGlobals &&
			!Wikia.InstantGlobals['wgSitewideDisableIVW3'] &&
			ivw3 && ivw3.countries &&
			typeof ivw3.countries.indexOf === 'function' &&
			ivw3.countries.indexOf(M.geo.country) !== -1
		) {
			M.loadScript('https://script.ioam.de/iam.js', true, function () {
				if (triedToTrackWithoutLoadedLibrary) {
					window.trackIVW3PageView();
				}
			});
		}

		window.trackIVW3PageView = function() {
			if (!allowExternals) {
				return;
			}

			if (window.iom) {
				window.iam_skiponload = true;
				window.iom.c({
					st: 'wikia',
					cp: ivw3.cmKey,
					sv: 'mo'
				}, 2);
				console.info('Track pageView: IVW3');
			} else {
				triedToTrackWithoutLoadedLibrary = true;
			}
		};
	})();
</script>

<script>
	(function () {
		var config = M.getFromShoebox('tracking.nielsen') || {};

		function sendNielsenPageView() {
			var assetidRnd, globalParams;

			if (!window.NOLCMB || !window.NOLCMB.getInstance) {
				return;
			}

			assetidRnd = Math.round(1000000 * Math.random());
			globalParams = {
				sfcode: 'dcr',
				apid: config.apid,
				apn: 'wikiaCOM'
			};

			window.gg1 = window.NOLCMB.getInstance(globalParams);
			window.staticmeta = {
				type: 'static',
				assetid: assetidRnd,
				section: config.section,
				segA: config.dbName,
				segB: '',
				segC: ''
			};

			window.gg1.ggInitialize(globalParams);
			window.gg1.ggPM('staticstart', window.staticmeta);

			console.info('Track pageView: Nielsen');
		}

		window.trackNielsenPageView = function () {
			if (M.getFromShoebox('runtimeConfig.noExternals') || !config.enabled) {
				return;
			}

			if (typeof(config.apid) !== 'string' || config.apid === 'FIXME') {
				throw 'Invalid Nielsen apid';
			}

			delete window.NOLCMB;

			M.loadScript(
				'http://secure-dcr.imrworldwide.com/novms/js/2/ggcmb500.js?' + Date.now(),
				true,
				sendNielsenPageView
			);
		};

		window.trackNielsenPageView();
	})();
</script>

<script>
	(function () {
		var allowedCountries = [];
		var geo = M.geo || {};
		var config = M.getFromShoebox('tracking.netzathleten') || {};
		var isLoggedIn = Boolean(M.getFromShoebox('userData'));

		function initializeNetzAthletenTracking() {
			var script = document.createElement('script');

			script.id = 'Wikia_container';
			script.src = config.url;
			script.addEventListener('load', function () {
				window.naMediaAd.setValue('homesite', Boolean(M.getFromShoebox('wikiPage.data.isMainPage')));
			});
			document.head.appendChild(script);
		}

		if (
			!M.getFromShoebox('runtimeConfig.noExternals') &&
			config.enabled &&
			config.url &&
			!isLoggedIn &&
			window.Wikia
		) {
			allowedCountries = window.Wikia.InstantGlobals.wgAdDriverNetzAthletenCountries || [];

			if (
				allowedCountries.indexOf(geo.country) !== -1 ||
				allowedCountries.indexOf('XX') !== -1
			) {
				initializeNetzAthletenTracking();
			}
		}
	})();
</script>

{{content-for 'body-footer'}}
</body>
</html>
