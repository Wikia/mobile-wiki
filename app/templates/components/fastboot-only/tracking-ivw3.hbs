{{! template-lint-disable block-indentation }}
<script>
	(function () {
		var triedToTrackWithoutLoadedLibrary = false;
		var geo = M.geo || {};
		var countries = {{countries}};

		if (window.Wikia) {
			{{! Can't use && because Ember will convert it to &amp; }}
			if (!window.Wikia.InstantGlobals['wgSitewideDisableIVW3']) {
				if (countries.indexOf(geo.country) !== -1) {
					var scriptTag = document.createElement('script'),
							firstScriptInDocument = document.getElementsByTagName('script')[0];

					scriptTag.async = 1;
					scriptTag.src = 'https://script.ioam.de/iam.js';

					firstScriptInDocument.parentNode.insertBefore(scriptTag, firstScriptInDocument);

					scriptTag.onload = function () {
						if (triedToTrackWithoutLoadedLibrary) {
							window.trackIVW3PageView();
						}
					};
				}
			}
		}

		window.trackIVW3PageView = function () {
			if (window.iom) {
				window.iam_skiponload = true;
				window.iom.c({
					st: 'wikia',
					cp: '{{config.cmKey}}',
					sv: 'mo'
				}, 2);

				console.info('Track pageView: IVW3');
			} else {
				triedToTrackWithoutLoadedLibrary = true;
			}
		};
	})();
</script>
