{{wikia-ui-components/sub-header
	backArrowTooltip=(i18n 'app.cancel-label')
	confirmLabel=(i18n 'main.save' ns='infobox-builder')
	fixed=true
	onBack=(action 'cancel')
	onConfirm=(action 'save')
	title=(i18n 'main.header' ns='infobox-builder' title=title)
}}

<div class="infobox-builder">
	<div class="infobox-builder-preview article-background-color" {{action 'onPreviewBackgroundClick'}}>
		{{#sortable-group
			tagName='div'
			class=sortableGroupClassNames
			onChange=(action 'onReorderElements') as |group|
		}}
			{{#each state as |element index|}}
				{{component element.infoboxBuilderData.component
					activeItem=activeItem
					model=element
					group=group
					handle=".pi-item"
					position=index
					click=(action 'setEditItemAndStopPropagation' element)
					spacing=8
					onDragStart=(action 'onPreviewItemDrag')
					onDragStop=(action 'onPreviewItemDrop')
					onMouseEnter=(action 'showReorderTooltip')
					onMouseLeave=(action 'hideReorderTooltip')
				}}
			{{/each}}
		{{/sortable-group}}
		{{#if isReorderTooltipVisible}}
			{{wikia-ui-components/on-hover-tooltip
				posX=tooltipPosX
				posY=tooltipPosY
				fixed=true
				message=(i18n 'main.reorder-tooltip' ns='infobox-builder')
			}}
		{{/if}}
	</div>
	<div class="infobox-builder-sidebar">
		{{#liquid-bind sideBarOptionsComponent use="toLeft" as |currentActiveComponentName|}}
			{{infobox-builder-sidebar-header
				item=activeItem
				onBackArrowClick=(action this.attrs.setEditItem null)
				onDeleteItem=(action this.attrs.removeItem)
			}}
			{{component currentActiveComponentName
				item=activeItem
				addItem=(action 'addItem')
				editRowItem=editRowItem
				editSectionHeaderItem=editSectionHeaderItem
				editTitleItem=editTitleItem
			}}
		{{/liquid-bind}}
	</div>
</div>
{{#if showOverlay}}
	<div class="infobox-builder-spinner loading-overlay">
	{{#if isLoading}}
		{{loading-spinner
			active=true
			radius=38
			overlay=false
			strokeWidth=3
		}}
		<div class="spinner-text">
			{{i18n 'main.saving' ns='infobox-builder'}}
		</div>
	{{/if}}
	{{#if showSuccess}}
		{{svg 'success' class='success-icon' viewBox='0 0 80 80'}}
		<div class="spinner-text">
			{{i18n 'main.success' ns='infobox-builder'}}
		</div>
	{{/if}}
	</div>
{{/if}}
